{% extends "backoffice/layout.html" %}
{% load bootstrap3 %}

{% block title %}Mes classes{% endblock title %}

{% block navbar_administration %}active{% endblock navbar_administration %}

{% block content %}

<div class="modal fade" id="confirm-delete" tabindex="-1" role="dialog" aria-labelledby="confirmation-modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                Confirmer la suppression
            </div>
            <div class="modal-body">
                <p>Vous êtes sur le point de supprimer la classe <strong id="class-name-modal"></strong>.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
                <button id="confirm-delete-modal" type="button" class="btn btn-danger">Supprimer</button>
            </div>
        </div>
    </div>
</div>

{% if classes %}
<form id="delete-class-form" method="post" action="/backoffice/delete_class/">
	<input id="class-id-input" type="hidden" name="class_id" value="-1">
	{% csrf_token %}
	<table class="table table-striped">
    	<thead>
        	<tr>
            	<th data-field="name">Classe</th>
            	<th data-field="school">Etablissement</th>
            	<th>Editer</th>
            	<th>Supprimer</th>
        	</tr>
    	</thead>
    	<tbody>
			{% for class in classes %}
			<tr>
				<td>{{class.name}}</td>
				<td>{{class.school_name}}</td>
				<td><a href="{% url 'backoffice:edit_class' id=class.id %}" class="btn btn-xs btn-primary">Editer</a></td>
				<td><button type="button" class="btn btn-xs btn-danger" data-class-name="{{class.name}}" data-class-id="{{class.id}}" data-toggle="modal" data-target="#confirm-delete">Supprimer</button></td>
			</tr>
			{% endfor %}
		</tbody>
	</table>
</form>
{% else %}
<div class="alert alert-danger" role="alert">Votre compte n'est pas encore associé à une classe</div>
{% endif %}

<a class="btn btn-primary" href="{% url 'backoffice:create_class' %}">{% bootstrap_icon "plus" %} Créer une classe</a>
{% endblock content %}

{% block script %}
	$('#confirm-delete').on('show.bs.modal', function(e) {
		$('#class-id-input').val(e.relatedTarget.getAttribute('data-class-id'));
		$('#class-name-modal').text(e.relatedTarget.getAttribute('data-class-name'))
	});
	$('#confirm-delete-modal').on('click', function(e) {
		$("#delete-class-form").submit();
	});
{% endblock script %}